<!-- Sticky Header -->
<header class="header">
  <div class="container">
    <nav class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button (click)="navigateHome()"
          class="text-2xl font-bold hover:opacity-80 transition-opacity cursor-pointer border-none bg-transparent p-0"
          style="background: linear-gradient(135deg, var(--accent-0), var(--blush-300)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
          aria-label="Gå till startsidan">
          ÅVC Kollen
        </button>
      </div>
      <div class="flex gap-2 items-center">
        <a routerLink="/sorteringsguide" class="nav-link">Så sorterar du</a>
        <a routerLink="/om" class="nav-link">Om ÅVC-kollen</a>
        <a routerLink="/kontakt" class="nav-link">Kontakt</a>

        <!-- Mina ÅVC with PrimeNG Select -->
        <div class="w-64">
          <p-select [options]="getFavoritesList()" placeholder="Mina ÅVC" [(ngModel)]="selectedFavorite"
            [showClear]="false" (onChange)="onStationSelect($event)" [optionLabel]="'name'" optionGroupLabel="name"
            class="my-favourites-select w-full" panelStyleClass="my-favourites-select-overlay"
            dropdownStyleClass="custom-select-dropdown">
            <ng-template let-option pTemplate="item">
              @if (option) {
              <div class="flex items-center gap-3 cursor-pointer py-2">
                <i class="pi pi-map-marker" style="color: var(--accent-0); flex-shrink: 0;"></i>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-sm text-[var(--text-0)]">{{ option.name }}</p>
                  @if (option.municipality_name) {
                  <p class="text-xs text-[var(--text-2)]">{{ option.municipality_name }}</p>
                  }
                  <p class="text-xs text-[var(--text-1)] mt-0.5">{{ option.distance | number:'1.1-1' }} km bort</p>
                </div>
              </div>
              }
            </ng-template>
            <ng-template pTemplate="header">
              <div class="flex items-center justify-between px-4 py-3" style="background: transparent;">
                <span class="font-semibold flex items-center gap-2 text-[var(--text-0)]">
                  <i class="pi pi-heart-fill" style="color: var(--accent-0);"></i>
                  Mina favoriter
                </span>
                @if (getFavoritesList().length > 0) {
                <!-- Just clear local view or implement clear all in service if needed -->
                <span class="text-xs text-[var(--text-2)]">{{ getFavoritesList().length }} sparade</span>
                }
              </div>
            </ng-template>
            <ng-template pTemplate="empty">
              <div class="px-4 py-6 text-center text-[var(--text-2)] text-sm">
                <i class="pi pi-heart text-lg block mb-2"></i>
                Ingen favoriter ännu
              </div>
            </ng-template>
          </p-select>
        </div>

        <!-- Auth Section -->
        <div class="auth-section">
          @if (authService.currentUser$ | async; as user) {
          <a routerLink="/profile" class="profile-link">
            <i class="pi pi-user"></i>
            <span class="profile-email">{{ user.email }}</span>
          </a>
          <button (click)="logout()" class="logout-btn" title="Logga ut">
            <i class="pi pi-sign-out"></i>
          </button>
          } @else {
          <a routerLink="/login" class="login-btn">
            <i class="pi pi-sign-in"></i>
            <span>Logga in</span>
          </a>
          }
        </div>
      </div>
    </nav>
  </div>
</header>

<!-- Station Detail Dialog -->
<app-station-detail [station]="selectedStation()" [visible]="showStationDetail()"
  (onHide)="showStationDetail.set(false)">
</app-station-detail>