<div class="page bg-[var(--bg-0)] min-h-screen">
    <div class="container">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold mb-2">Sorteringsguide</h1>
                <p class="text-[var(--text-1)]">Sök och hitta hur du sorterar ditt avfall</p>
            </div>

            <!-- Search Input -->
            <div class="w-full md:w-auto relative">
                <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-2)]"></i>
                <input type="text" [(ngModel)]="searchQuery" (keyup.enter)="onSearch()" placeholder="Sök i guiden..."
                    class="search-input pl-10 w-full md:w-80">
            </div>
        </div>

        <!-- Loading State -->
        @if (isLoading()) {
        <div class="flex justify-center py-12">
            <i class="pi pi-spin pi-spinner text-4xl text-[var(--accent-0)]"></i>
        </div>
        }

        <!-- Articles Grid -->
        @if (!isLoading()) {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (article of articles(); track article.id) {
            <div class="card p-6 cursor-pointer hover:transform hover:-translate-y-1 transition-all duration-300 h-full flex flex-col"
                (click)="selectArticle(article)">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-full bg-[var(--accent-soft)] flex items-center justify-center">
                        <i class="pi pi-book text-[var(--accent-1)]"></i>
                    </div>
                    <h3 class="font-bold text-lg">{{ article.title }}</h3>
                </div>
                <p class="text-[var(--text-1)] text-sm mb-4 flex-grow line-clamp-3">
                    {{ article.content || 'Ingen beskrivning tillgänglig.' }}
                    <!-- Using content as excerpt since excerpt might be missing in mockup data -->
                </p>
                <span class="text-[var(--accent-0)] text-sm font-semibold flex items-center gap-1 group">
                    Läs mer <i class="pi pi-arrow-right text-xs group-hover:translate-x-1 transition-transform"></i>
                </span>
            </div>
            }

            @if (articles().length === 0) {
            <div class="col-span-full text-center py-12 text-[var(--text-2)]">
                <i class="pi pi-info-circle text-4xl mb-4 block"></i>
                Inga artiklar hittades.
            </div>
            }
        </div>
        }
    </div>
</div>

<!-- Article Detail Modal -->
@if (selectedArticle(); as article) {
<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm fade-in"
    (click)="clearSelection()">
    <div class="bg-[var(--bg-1)] rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl relative"
        (click)="$event.stopPropagation()">
        <!-- Header -->
        <div
            class="sticky top-0 bg-[var(--bg-1)] p-6 border-b border-[var(--border-0)] flex justify-between items-center z-10">
            <h2 class="text-2xl font-bold">{{ article.title }}</h2>
            <button
                class="w-8 h-8 rounded-full bg-[var(--bg-2)] hover:bg-[var(--accent-soft)] flex items-center justify-center transition-colors"
                (click)="clearSelection()">
                <i class="pi pi-times"></i>
            </button>
        </div>

        <!-- Content -->
        <div class="p-6">
            <div class="prose prose-invert max-w-none">
                <p class="text-lg text-[var(--text-0)] mb-4">{{ article.content }}</p>

                @if (article.fractions && article.fractions.length > 0) {
                <div class="mt-6 p-4 bg-[var(--bg-2)] rounded-lg">
                    <h4 class="font-semibold mb-2 flex items-center gap-2">
                        <i class="pi pi-tags text-[var(--accent-0)]"></i>
                        Relaterade fraktioner
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        @for (fraction of article.fractions; track fraction) {
                        <span
                            class="badge bg-[var(--accent-soft)] text-[var(--accent-1)] px-3 py-1 rounded-full text-sm">
                            {{ fraction }}
                        </span>
                        }
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-[var(--border-0)] flex justify-end gap-3 sticky bottom-0 bg-[var(--bg-1)]">
            <button class="btn btn--secondary" (click)="clearSelection()">Stäng</button>
            <a routerLink="/stationer" class="btn btn--primary">
                <i class="pi pi-map-marker"></i> Hitta station
            </a>
        </div>
    </div>
</div>
}